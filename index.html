<!DOCTYPE html>
<html lang="en-US">
<title>Endtime Entreprenuers</title>

<head>
    <meta name="description" content="test 123 abc lets see if this works">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://kit.fontawesome.com/19bf467a51.js" crossorigin="anonymous"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- Popper JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="index.css">
    <link rel="icon" href="https://Endtime-Entrepreneurs.github.io/EETestLogo.png">
    <meta name="description" content="test 123 abc lets see if this works">
</head>

<body onload="loadDoc()">
<img src="WebBanner.png" alt="Web banner." style="width:100%;"/>
<nav>
    <input type="checkbox" id="check">
    <label for="check" class="checkbtn"><i class="fas fa-bars"></i></label>
    <label class="logo">Endtime Entrepreneurs</label>
<ul>
    <li><a href="/" class="menubtn">Home</a></li>
    <li><a href="/Games.html" class="menubtn">Games</a></li>
    <li><a href="/news.html" class="menubtn">News</a></li>
    <li><a href="/contact.html" class="menubtn">Contact Us</a></li>
</ul>
</nav>
<div class="nav-margin"></div>
<div class="container" id="article_holder">
    <h1 class="text-center">    Some of our latest updates</h1>
    <p class="text-center">Find out below how the developers are doing <br> Check the contact us page if you are interested in joining our team!</p>
</div>

<br>
<br>
<script type="text/javascript">
  function loadDoc() {
    var search = window.location.search;
    var articles = search.split("?");
    var selectedArticle = "";

    for(let i = 0; i < articles.length; i++) {
      if(articles[i].indexOf("article") > -1){
        var mine = articles[i];
        var article = mine.substring(8, mine.length);
        selectedArticle = article;
      }
    }

    const xhttp = new XMLHttpRequest();
    xhttp.onload = function() {parseArticleList(this);}
    xhttp.open("GET", "articlelist.txt");
    xhttp.send();
  }
  async function getData(ajaxurl) { 
        return await $.getJSON({
            url: ajaxurl,
            type: 'GET',
        });
    };
  async function fillArticle(index, articleName){
      if(articleName == undefined) {
          return;
      }
    //const xhttp = new XMLHttpRequest();
    //xhttp.onload = function() {
        
    //}
    //xhttp.open("GET", "Articles/" + articleName + ".xml", true);
    //await xhttp.send();
    xhttp = await getData("Articles/" + articleName + ".json");
    if(xhttp == undefined){
        return;
    }
    console.log(xhttp["Author"]);
    console.log(xhttp["Date"]);
    var longText = xhttp["Text"];
    var text = longText.substring(0, Math.min(200, longText.indexOf("<br/>", 100)));
    var title = xhttp["Title"];
    var authors = xhttp["Author"];
    var date = xhttp["Date"];
    $("#article_holder").append(createArticle(articleName, authors, date, title, text));
  }
  function createArticle(filename, authors, date, title, text) {
      var row = $("<div>");
      row.addClass("single-blog");
      var div = $("<div>");
      row.append(div);
      div.addClass("row");
      div.addClass("no-gutters");
      var workingDiv = $("<div>");
      div.append(workingDiv);
      workingDiv.addClass("col-2");
      var currentElement = $("<a>");
      workingDiv.append(currentElement);
      currentElement.attr("href", "article-parser.html?article=" + filename);
      currentElement.append(createImage(authors));
      workingDiv = $("<div>");
      div.append(workingDiv);
      workingDiv.addClass("col");
      workingDiv.addClass("pl-2");
      currentElement = $("<h2>");
      workingDiv.append(currentElement);
      var insideElement = $("<a>");
      currentElement.append(insideElement);
      insideElement.attr("href", "article-parser.html?article=" + filename);
      insideElement.text(title);
      currentElement = $("<p>");
      workingDiv.append(currentElement);
      currentElement.html("By " + authors + " on " + date);
      currentElement.addClass("blog-meta");
      currentElement = $("<p>");
      workingDiv.append(currentElement);
      currentElement.html(text);
      currentElement.addClass("blog-text");
      currentElement = $("<p>");
      workingDiv.append(currentElement);
      insideElement = $("<a>");
      currentElement.append(insideElement);
      insideElement.attr("href", "article-parser.html?article=" + filename);
      insideElement.addClass("read-more-btn");
      insideElement.text("Read More");
      return row;
  }
  function createImage(authors) {
      var src = "EETestLogo.png";
      if(authors.indexOf("DaDarkWizard") > -1) {
        src = "Wizard.png";
      }
      else if (authors.indexOf("Airy") > -1) {
          src = "Airy.png";
      }
      var image = $("<img src=\"" + src + "\">");
      return image;
  }
  async function parseArticleList(text) {
    const textLines = text.responseText.split('\n');
    for(var i = -1; i < 3; i++){
        await fillArticle(i + 1, textLines[i]);
    }
  }
</script>
</body>
</html>